<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Full-Screen AI Chatbot</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            height: 100vh;
            overflow: hidden;
        }
        .chat-container {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            background: #f4f4f4;
        }
        .tabs {
            display: flex;
            background: #007bff;
            color: white;
            padding: 10px;
        }
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
        }
        .tab.active {
            background: #0056b3;
        }
        .chat-area {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: #f9f9f9;
        }
        .message {
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 10px;
            max-width: 70%;
        }
        .user-message {
            background: #007bff;
            color: white;
            align-self: flex-end;
            margin-left: auto;
        }
        .bot-message {
            background: #e9ecef;
            color: black;
        }
        .chat-input {
            display: flex;
            padding: 20px;
            border-top: 1px solid #ddd;
            background: white;
        }
        .chat-input input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .chat-input button {
            padding: 10px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            margin-left: 10px;
            cursor: pointer;
        }
        .chat-input button:hover {
            background: #0056b3;
        }
        .add-tab {
            padding: 10px 20px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-left: auto;
        }
        .add-tab:hover {
            background: #218838;
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="tabs">
            <button class="add-tab" onclick="addChat()">+ New Chat</button>
        </div>
        <div class="chat-area">
            <div class="chat-messages" id="chat-messages">
                <div class="message bot-message">Hello! How can I help you today?</div>
            </div>
            <div class="chat-input">
                <input type="text" id="user-input" placeholder="Type your message...">
                <button onclick="sendMessage()">Send</button>
            </div>
        </div>
    </div>

    <script>
        let chats = [{ id: 1, messages: [{ text: "Hello! How can I help you today?", sender: "bot" }] }];
        let currentChatId = 1;
        const chatMessages = document.getElementById('chat-messages');
        const userInput = document.getElementById('user-input');
        const tabsContainer = document.querySelector('.tabs');

        import {
            GoogleGenerativeAI, // Classe para interagir com o Google Generative AI
            HarmCategory,       // Enum para categorias de conteúdo prejudicial
            HarmBlockThreshold  // Enum para os níveis de bloqueio de conteúdo prejudicial
        } from "@google/generative-ai";

        import chalk from "chalk";
        import ora from "ora";
        import prompt from 'prompt-sync';

        const promptSync = prompt();
        const MODEL_NAME = "gemini-1.0-pro";
        const API_KEY = "AIzaSyCrIMv-WrvE_6XkWVNKzOXzJEJxlNEHiKo"

        // Configuração de geração para o modelo, ajustando parâmetros como temperatura e tokens de saída
        const GENERATION_CONFIG = {
            temperature: 1, //Define o quão criativa é a resposta da IA, de 0 a 1
            topK: 1, // Controla o número de palavras candidatas consideradas durante a geração
            topP: 1, // Controla a probabilidade cumulativa das palavras candidatas consideradas
            maxOutputTokens: 2048, // Define o número máximo de tokens (palavras) na resposta gerada
        };

        // Configuração de segurança para filtrar conteúdo prejudicial com diferentes categorias e limiares
        const SAFETY_SETTINGS = [
            {
                category: HarmCategory.HARM_CATEGORY_HARASSMENT, // Categoria de conteúdo prejudicial: assédio
                threshold: HarmBlockThreshold.BLOCK_MEDIUM_AND_ABOVE // Limitar para bloquear conteúdo com médio nível de gravidade e acima
            },
            {
                category: HarmCategory.HARM_CATEGORY_HATE_SPEECH, // Categoria de conteúdo prejudicial: discurso de ódio
                threshold: HarmBlockThreshold.BLOCK_MEDIUM_AND_ABOVE // Limitar para bloquear conteúdo com médio nível de gravidade e acima
            },
            {
                category: HarmCategory.HARM_CATEGORY_SEXUALLY_EXPLICIT, // Categoria de conteúdo prejudicial: conteúdo sexual explícito
                threshold: HarmBlockThreshold.BLOCK_MEDIUM_AND_ABOVE // Limitar para bloquear conteúdo com médio nível de gravidade e acima
            },
            {
                category: HarmCategory.HARM_CATEGORY_DANGEROUS_CONTENT, // Categoria de conteúdo prejudicial: conteúdo perigoso
                threshold: HarmBlockThreshold.BLOCK_MEDIUM_AND_ABOVE // Limitar para bloquear conteúdo com médio nível de gravidade e acima
            },
        ];

        async function runChat() {
            // Cria e inicia um spinner para indicar que o chat está sendo inicializado
            const spinner = ora('Inicializando chat...').start();

            try {
                // Cria uma instância da classe GoogleGenerativeAI com a chave da API
                const genAI = new GoogleGenerativeAI(API_KEY);

                // Obtém o modelo generativo especificado usando o nome do modelo
                const model = genAI.getGenerativeModel({
                    model: MODEL_NAME
                });

                // Inicia uma sessão de chat com as configurações de geração e segurança definidas
                const chat = model.startChat({
                    generationConfig: GENERATION_CONFIG,
                    safetySettings: SAFETY_SETTINGS,
                    history: [], // Inicializa o histórico do chat como vazio
                });

                // Para o spinner, pois a inicialização foi concluída
                spinner.stop();

                // Loop infinito para ler entradas do usuário e gerar respostas
                while (true) {
                    // Lê a entrada do usuário, exibindo um prompt verde "Você: "
                    const userInput = promptSync(chalk.green('Você: '));

                    // Verifica se a entrada do usuário é 'exit' (ignora maiúsculas/minúsculas)
                    if (userInput.toLowerCase() === 'exit') {
                        // Exibe uma mensagem de despedida e encerra o processo
                        console.log(chalk.yellow('Até breve!'));
                        process.exit(0); // Encerra o processo com código de saída 0 (sucesso)
                    }

                    // Envia a mensagem do usuário para o chat e aguarda a resposta
                    const result = await chat.sendMessage(userInput);

                    // Verifica se houve um erro na resposta da IA
                    if (result.error) {
                        // Exibe uma mensagem de erro em vermelho
                        console.error(chalk.red('AI Erro:'), result.error.message);
                        continue; // Continua o loop para permitir novas entradas do usuário
                    }

                    // Obtém o texto da resposta da IA
                    const response = result.response.text;
                    // Exibe a resposta da IA em azul
                    console.log(chalk.blue('AI:'), response);
                }
            } catch (error) {
                // Para o spinner se ocorrer um erro
                spinner.stop();
                // Exibe uma mensagem de erro em vermelho
                console.error(chalk.red('Erro encontrado:'), error.message);
                // Encerra o processo com código de saída 1 (erro)
                process.exit(1);
            }
        }

        // Chama a função runChat para iniciar o chat
        runChat();
        
    </script>
</body>
</html>
